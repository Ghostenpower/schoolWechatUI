<!-- pages/order/detail/index.wxml -->
<view class="container">
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading"></view>
    <view class="loading-text">åŠ è½½ä¸­...</view>
  </view>
  <block wx:else>
    <!-- è®¢å•åŸºæœ¬ä¿¡æ¯ -->
    <view class="order-header">
      <view class="title">{{taskInfo.title || 'æœªå‘½åä»»åŠ¡'}}</view>
      <view class="status-group">
        <view class="status-tag order-status {{orderInfo.orderStatus === 1 ? 'pending' : orderInfo.orderStatus === 2 ? 'processing' : orderInfo.orderStatus === 3 ? 'completed' : orderInfo.orderStatus === 4 ? 'cancelled' : ''}}">
          {{orderStatusMap[orderInfo.orderStatus] || 'æœªçŸ¥çŠ¶æ€'}}
        </view>
      </view>
    </view>
    <!-- ä»»åŠ¡è¯¦æƒ… -->
    <view class="section">
      <view class="section-header">
        <text class="section-title">ä»»åŠ¡è¯¦æƒ…</text>
      </view>
      <view class="section-content">
        <view class="info-row">
          <text class="label">å–ä»¶åœ°ç‚¹ï¼š</text>
          <text class="value clickable" bindtap="onViewPickupLocation">
            {{taskInfo.pickupLocation || 'æš‚æ— '}}
          </text>
        </view>
        <view class="info-row">
          <text class="label">é€è¾¾åœ°ç‚¹ï¼š</text>
          <text class="value clickable" bindtap="onViewDeliveryLocation">
            {{taskInfo.deliveryLocation || 'æš‚æ— '}}
          </text>
        </view>
        <view class="info-row">
          <text class="label">æˆªæ­¢æ—¶é—´ï¼š</text>
          <text class="value">{{taskInfo.deadlineFormatted || 'æš‚æ— '}}</text>
        </view>
        <view class="info-row">
          <text class="label">ä»»åŠ¡ç±»å‹ï¼š</text>
          <text class="value">
            {{taskInfo.taskType === 0 ? 'å¤–å–ä»£å–' : taskInfo.taskType === 1 ? 'å¿«é€’ä»£å–' : 'å…¶ä»–'}}
          </text>
        </view>
        <view class="info-row">
          <text class="label">ä»»åŠ¡æŠ¥é…¬ï¼š</text>
          <text class="value price">Â¥ {{taskInfo.price || 0}}</text>
        </view>
        <view class="info-row" wx:if="{{taskInfo.remark}}">
          <text class="label">ä»»åŠ¡å¤‡æ³¨ï¼š</text>
          <text class="value">{{taskInfo.remark}}</text>
        </view>
        <view class="info-row">
          <text class="label">ä»»åŠ¡æè¿°ï¼š</text>
          <text class="value">{{taskInfo.description || 'æš‚æ— æè¿°'}}</text>
        </view>
      </view>
    </view>
    <!-- ä»»åŠ¡å‘å¸ƒè€…ä¿¡æ¯ -->
    <view class="section">
      <view class="section-header">
        <text class="section-title">å‘å¸ƒè€…ä¿¡æ¯</text>
      </view>
      <view class="section-content">
        <view class="user-card">
          <image class="avatar" src="{{customerInfo.avatarUrl || '/images/default-avatar.png'}}" mode="aspectFill"></image>
          <view class="user-info">
            <text class="username">{{customerInfo.username || 'æœªçŸ¥ç”¨æˆ·'}}</text>
            <text class="user-phone" wx:if="{{customerInfo.phone}}">{{customerInfo.phone}}</text>
          </view>
        </view>
        <view class="contact-buttons">
          <button class="action-btn call-btn" bindtap="onCallPhone" data-phone="{{customerInfo.phone}}" wx:if="{{customerInfo.phone}}">
            <text class="icon">ğŸ“</text>
            ç”µè¯è”ç³»
          </button>
          <button class="action-btn chat-btn" bindtap="onStartChat" data-userid="{{taskInfo.userId}}">
            <text class="icon">ğŸ’¬</text>
            åœ¨çº¿è”ç³»
          </button>
        </view>
      </view>
    </view>
    <!-- è®¢å•ä¿¡æ¯ -->
    <view class="section">
      <view class="section-header">
        <text class="section-title">è®¢å•ä¿¡æ¯</text>
      </view>
      <view class="section-content">
        <view class="info-row">
          <text class="label">è®¢å•å·ï¼š</text>
          <text class="value">{{orderInfo.orderId || 'æš‚æ— '}}</text>
        </view>
        <view class="info-row">
          <text class="label">æ¥å•æ—¶é—´ï¼š</text>
          <text class="value">{{orderInfo.acceptTimeFormatted || 'æš‚æ— '}}</text>
        </view>
        <view class="info-row" wx:if="{{orderInfo.completionTime}}">
          <text class="label">å®Œæˆæ—¶é—´ï¼š</text>
          <text class="value">{{orderInfo.completionTimeFormatted || 'æš‚æ— '}}</text>
        </view>
        <view class="info-row" wx:if="{{orderInfo.cancelTime}}">
          <text class="label">å–æ¶ˆæ—¶é—´ï¼š</text>
          <text class="value">{{orderInfo.cancelTimeFormatted || 'æš‚æ— '}}</text>
        </view>
        <view class="info-row" wx:if="{{orderInfo.cancelReason}}">
          <text class="label">å–æ¶ˆåŸå› ï¼š</text>
          <text class="value">{{orderInfo.cancelReason}}</text>
        </view>
      </view>
    </view>
    <!-- çŠ¶æ€æ ‡è¯† -->
    <view class="status-tips" wx:if="{{orderInfo.orderStatus === 3}}">
      <view class="status-icon completed">âœ“</view>
      <view class="status-text">è®¢å•å·²å®Œæˆ</view>
      <view class="status-desc">æ„Ÿè°¢æ‚¨çš„ä½¿ç”¨ï¼ŒæœŸå¾…å†æ¬¡ä¸ºæ‚¨æœåŠ¡</view>
    </view>
    <view class="status-tips" wx:if="{{orderInfo.orderStatus === 4}}">
      <view class="status-icon cancelled">âœ•</view>
      <view class="status-text">è®¢å•å·²å–æ¶ˆ</view>
      <view class="status-desc">{{orderInfo.cancelReason || 'ç”¨æˆ·ä¸»åŠ¨å–æ¶ˆ'}}</view>
    </view>
    <!-- æ“ä½œæŒ‰é’® -->
    <view class="bottom-actions" wx:if="{{orderInfo.orderStatus === 1}}">
      <view class="action-wrapper">
        <text class="cancel-link" bindtap="onCancelOrder">å–æ¶ˆè®¢å•</text>
        <button class="btn primary-btn" bindtap="onStartTask" hover-class="btn-hover">
          <text class="btn-icon">â–¶</text>
          å¼€å§‹ä»»åŠ¡
        </button>
      </view>
    </view>
    <view class="bottom-actions" wx:if="{{orderInfo.orderStatus === 2}}">
      <view class="action-wrapper">
        <text class="cancel-link" bindtap="onCancelOrder">å–æ¶ˆè®¢å•</text>
        <button class="btn primary-btn" bindtap="onConfirmComplete" hover-class="btn-hover">
          <text class="btn-icon">âœ“</text>
          ç¡®è®¤å®Œæˆ
        </button>
      </view>
    </view>
    <!-- è®¢å•å·²å®Œæˆ/å–æ¶ˆæ—¶çš„åº•éƒ¨æŒ‰é’® -->
    <view class="bottom-actions" wx:if="{{orderInfo.orderStatus === 3 || orderInfo.orderStatus === 4}}">
      <button class="btn back-btn" bindtap="onBackToList" hover-class="btn-hover">è¿”å›è®¢å•åˆ—è¡¨</button>
    </view>
  </block>
</view>